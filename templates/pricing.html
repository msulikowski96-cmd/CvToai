
{% extends "base.html" %}

{% block title %}Cennik - CV Optimizer Pro{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <h2 class="text-center mb-5">Wybierz swój plan</h2>
            
            <div class="row">
                <!-- Jednorazowe użycie -->
                <div class="col-md-4 mb-4">
                    <div class="card h-100 border-primary">
                        <div class="card-header bg-primary text-white text-center">
                            <h4>Jednorazowe</h4>
                        </div>
                        <div class="card-body text-center">
                            <h2 class="text-primary">9,99 zł</h2>
                            <p class="text-muted">za jedno generowanie</p>
                            
                            <ul class="list-unstyled">
                                <li>✅ 1 optymalizacja CV</li>
                                <li>✅ Analiza ATS</li>
                                <li>✅ Sprawdzenie gramatyki</li>
                                <li>❌ Opinia rekrutera</li>
                                <li>❌ List motywacyjny</li>
                            </ul>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary btn-block" onclick="buySingleUse()">
                                Kup teraz
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Premium miesięczny -->
                <div class="col-md-4 mb-4">
                    <div class="card h-100 border-success">
                        <div class="card-header bg-success text-white text-center">
                            <h4>Premium Miesięczny</h4>
                            <span class="badge badge-warning">Popularne</span>
                        </div>
                        <div class="card-body text-center">
                            <h2 class="text-success">30,00 zł</h2>
                            <p class="text-muted">miesięcznie</p>
                            
                            <ul class="list-unstyled">
                                <li>✅ 15 optymalizacji CV</li>
                                <li>✅ Wszystkie funkcje AI</li>
                                <li>✅ Opinia rekrutera</li>
                                <li>✅ List motywacyjny</li>
                                <li>✅ Pytania do rozmowy</li>
                                <li>✅ Analiza słów kluczowych</li>
                            </ul>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-success btn-block" onclick="buyPremiumMonthly()">
                                Rozpocznij subskrypcję
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Premium roczny -->
                <div class="col-md-4 mb-4">
                    <div class="card h-100 border-warning">
                        <div class="card-header bg-warning text-dark text-center">
                            <h4>Premium Roczny</h4>
                            <span class="badge badge-danger">Oszczędź 47%</span>
                        </div>
                        <div class="card-body text-center">
                            <h2 class="text-warning">189,99 zł</h2>
                            <p class="text-muted">rocznie</p>
                            <small class="text-success">zamiast 360 zł</small>
                            
                            <ul class="list-unstyled mt-3">
                                <li>✅ <strong>Nielimitowane</strong> generowania</li>
                                <li>✅ Wszystkie funkcje Premium</li>
                                <li>✅ Pierwszeństwo w obsłudze</li>
                                <li>✅ Nowe funkcje w pierwszej kolejności</li>
                                <li>✅ Generator CV AI</li>
                            </ul>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-warning btn-block" onclick="buyPremiumYearly()">
                                Kup na rok
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
const stripe = Stripe('{{ config.VITE_STRIPE_PUBLIC_KEY }}');

function buySingleUse() {
    fetch('/payment/create-single-payment', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            stripe.confirmCardPayment(data.client_secret).then(result => {
                if (result.error) {
                    alert('Płatność nieudana: ' + result.error.message);
                } else {
                    alert('Płatność udana! Możesz teraz wygenerować CV.');
                    window.location.href = '/';
                }
            });
        } else {
            alert('Błąd: ' + data.message);
        }
    });
}

function buyPremiumMonthly() {
    fetch('/payment/create-premium-monthly', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.href = data.checkout_url;
        } else {
            alert('Błąd: ' + data.message);
        }
    });
}

function buyPremiumYearly() {
    fetch('/payment/create-premium-yearly', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.href = data.checkout_url;
        } else {
            alert('Błąd: ' + data.message);
        }
    });
}
</script>
{% endblock %}
